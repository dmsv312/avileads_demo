{{ template "dictionary/base/base.html" . }}
{{ define "js" }}
<script src="/static/js/vacancy-admin.js" defer></script>
<script src="/static/js/select2.min.js"></script>
{{ end }}

{{ define "content" }}
<div class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 main">
    <h1 class="page-header">Редактирование рекламной компании</h1>
    {{if .flash.error}}
      <div class="alert alert-danger" role="alert"><p>{{.flash.error}}</p></div>
    {{end}}
  
    {{if .flash.notice}}
      <div class="alert alert-success" role="alert"><p>{{.flash.notice}}</p></div>
    {{end}}

    <div class="mb-3">
        <input type="checkbox" class="form-check-input" id="open-ai-support" {{if .records.OpenAiSupport}}checked{{end}}>
        <label class="form-check-label fw-bold">OpenAI группы вакансий</label>
    </div>

    <div class="mb-3">
        <button id="saveAllBtn" class="btn btn-success">
            Сохранить
        </button>

        {{if .records.Id}}
        <a class="btn btn-primary"
           href="/dict/vacancy_admin/edit/0?copyFrom={{.records.Id}}">
            Копировать
        </a>
        {{end}}
    </div>

    <div class="card px-3 py-3" id="vacancy-card">
        <form class="row" method="post" action="/dict/vacancy_admin/update">
        <input type="hidden" id="vacancyId" name="vacancyId" value="{{.records.Id}}">

        <div class="mb-3">
            {{if .records.Id}}
                {{if .offers}}
                    <input id="LoadToZP" name="loadToZP" type="checkbox" class="form-check-input" {{if .records.LoadToZp}}checked{{end}}>
                {{else}}
                    <input id="LoadToZP" name="loadToZP" type="checkbox" class="form-check-input" disabled>
                {{end}}
            {{else}}
                <input id="LoadToZP" name="loadToZP" type="checkbox" class="form-check-input" disabled>
            {{end}}
            <label class="form-check-label fw-bold" for="LoadToZP">Активная</label>
        </div>

        <div id="vacancy-view-info"  class="mb-3"></div>

        <div id="vacancy-dicts"     class="mb-3"></div>

        <div id="vacancy-text"
             class="d-none"
             data-rekl-id="{{if .records.ReklId}}{{$id := .records.ReklId}}{{$id}}{{else}}0{{end}}"
             data-buying-type-id="{{if .records.BuyingTypeId}}{{$id := .records.BuyingTypeId}}{{$id}}{{else}}0{{end}}"
             data-prof-id="{{if .records.ProfessionId}}{{$id := .records.ProfessionId}}{{$id}}{{else}}0{{end}}"
             data-provider-id="{{if .records.ProviderId}}{{$id := .records.ProviderId}}{{$id}}{{else}}0{{end}}"
             data-traffic-source-id="{{if .records.TrafficSourceId}}{{$id := .records.TrafficSourceId}}{{$id}}{{else}}0{{end}}"
             data-export-type-id="{{if .records.ExportTypeId}}{{.records.ExportTypeId}}{{else}}0{{end}}"
             data-cpa-ex-id="{{if .records.CpaExId}}{{.records.CpaExId}}{{end}}"
             data-other-specification="{{if .records.OtherSpecification}}{{.records.OtherSpecification}}{{end}}">
            {{.information}}
        </div>

        <div class="mb-3">
            <label for="vacancyIdAvito" class="col-form-label fw-bold">ID Авито</label>
            <div id="manualAvitoInfo" class="alert alert-info py-1 px-2 d-none"></div>
            <input type="text" class="form-control" id="vacancyIdAvito" name="vacancyIdAvito"
                   placeholder="ID Авито" value="{{.avito_ids}}" readonly>

            <label class="btn btn-outline-secondary mt-2" id="avitoFileLabel">
                <span class="label-text">Загрузить из файла (.xlsx)</span>
                <input type="file" id="avitoFile" accept=".xlsx" hidden>
            </label>

            <button type="button"
                    id="btn-manual-avito"
                    class="btn btn-secondary mt-2 manual-avito-btn"
                    data-file-input="avitoFile"
                    data-file-label="avitoFileLabel"
                    data-info-div="manualAvitoInfo"
                    data-bs-toggle="modal"
                    data-bs-target="#manualAvitoModal">
                Загрузить вручную
            </button>

            <button type="button"
                    class="btn btn-primary mt-2 btn-download-avito">
                Скачать ID Авито
            </button>
        </div>
        
        <div class="mb-3">
            <label for="description" class="col-form-label fw-bold">Описание</label>
            <textarea class="form-control" rows="10" id="description" name="description" style="white-space: pre-wrap;">{{.records.Description}}</textarea>
        </div>
        
        <div class="mb-3">
            <label for="helloText" class="col-form-label fw-bold">Текст приветствия</label>
            <textarea class="form-control" rows="10" id="helloText" name="helloText" style="white-space: pre-wrap;">{{.records.HelloText}}</textarea>
        </div>

        {{if not .records.OpenAiSupport}}
        <div id="questionnaire-block" class="card px-3 py-3 mt-4">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                    <tr>
                        <th>№</th>
                        <th>Текст вопроса</th>
                        <th>Текст некорректного ответа</th>
                        <th>Текст напоминания</th>
                        <th>Тип вопроса</th>
                        <th>!!!</th>
                        <th></th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    {{range $record := .questions}}
                    <tr data-question-id="{{$record.Id}}">
                        <form method="post" action="/dict/questions" class="row g-3">
                            <input type="hidden" id="questionid" name="questionid" value="{{$record.Id}}">
                            <input type="hidden" id="questId" name="questId" value="{{$.quest.Id}}">
                            <td>
                                {{$record.Sort}}
                            </td>
                            <td class="col-3">
                                <textarea class="form-control" rows="3" readonly id="questonName{{$record.Id}}" name="questonName{{$record.Id}}">{{$record.Text}}</textarea>
                            </td>
                            <td class="col-3">
                                <textarea class="form-control" rows="3" readonly id="wrongAnswerMessages{{$record.Id}}" name="wrongAnswerMessages{{$record.Id}}">{{$record.WrongAnswerMessages }}</textarea>
                            </td>
                            <td class="col-2">
                                <textarea class="form-control" rows="3" readonly id="followUpMessages{{$record.Id}}" name="followUpMessages{{$record.Id}}">{{$record.FollowUpMessages }}</textarea>
                            </td>
                            <td>
                                <div class="dropdown">
                                    <select class="form-select question-type-select"
                                            id="quest_type{{$record.Id}}"
                                            name="quest_type{{$record.Id}}"
                                            readonly disabled
                                            data-current="{{$record.TypeId}}">
                                    </select>
                                </div>
                            </td>
                            <td>
                                <input id="isRequired{{$record.Id}}" name="isRequired{{$record.Id}}" type="checkbox" class="form-check-input" {{if $record.IsRequired}}checked{{end}} disabled>
                            </td>
                            <td>
                                {{if compare $record.Sort 1 | not}}
                                <button class="btn btn-primary" type="submit" id="up" formaction="/dict/questions/up" method="post">&#10514;</button>
                                {{end}}
                                {{if compare $record.Sort $.record_count | not}}
                                <button class="btn btn-primary" type="submit" id="down" formaction="/dict/questions/down" method="post">&#10515;</button>
                                {{end}}
                            </td>
                            <td width="160">
                                <button type="button" onclick="setDisable(this,
                            ['saveQuestion{{$record.Id}}', 'quest_type{{$record.Id}}', 'isRequired{{$record.Id}}'],
                            ['questonName{{$record.Id}}', 'quest_type{{$record.Id}}', 'wrongAnswerMessages{{$record.Id}}', 'followUpMessages{{$record.Id}}'])" class="btn btn-secondary">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                                <button class="btn btn-primary" disabled type="submit" id="saveQuestion{{$record.Id}}">
                                    <i class="bi bi-save"></i>
                                </button>
                                <button class="btn btn-danger" type="button" data-bs-toggle="modal" data-bs-target="#deleteQuestion" data-whatever="{{$record.Id}}">
                                    <i class="bi bi-trash3"></i>
                                </button>
                            </td>
                        </form>
                    </tr>
                    {{end}}
                    <tr name="new_tr" id="new_tr" class="d-none" data-template="1">
                        <form method="post" class="row g-3" action="/dict/questions/add">
                            <input type="hidden" id="questId" name="questId" value="{{.quest.Id}}">
                            <td></td>
                            <td>
                                <textarea class="form-control" rows="3" id="questonNameNew" name="questonNameNew"></textarea>
                            </td>
                            <td>
                                <textarea class="form-control" rows="3" id="wrongAnswerMessagesNew" name="wrongAnswerMessagesNew"></textarea>
                            </td>
                            <td>
                                <textarea class="form-control" rows="3" id="followUpMessagesNew" name="followUpMessagesNew"></textarea>
                            </td>
                            <td>
                                <div class="dropdown">
                                    <select class="form-select question-type-select"
                                            id="quest_typeNew"
                                            name="quest_typeNew">
                                        {{range $type := .quest_types}}
                                        <option value="{{$type.Id}}">{{$type.Name}}</option>
                                        {{end}}
                                    </select>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <input id="isRequiredNew" name="isRequiredNew" type="checkbox" class="form-check-input">
                                </div>
                            </td>
                            <td></td>
                            <td>
                                <button class="btn btn-primary add-question-btn" type="button">Добавить</button>
                            </td>
                            <td></td>
                            <td></td>
                        </form>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="4">
                            <button type="button" onclick="deleteClass('new_tr','d-none')" class="btn btn-secondary">Добавить вопрос</button>
                        </td>
                    </tr>
                    </tfoot>
                </table>

                <div class="modal fade" id="deleteQuestion" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Удаление вопроса</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>

                            <div class="modal-body">
                                <p>Вы действительно хотите удалить запись?</p>
                                <input type="hidden" id="questionId">
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                                <button type="button" id="confirmDeleteQuestion" class="btn btn-primary">Удалить</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{end}}

        <div class="mb-3">
            <label for="byeText" class="col-form-label fw-bold">Текст прощания</label>
            <textarea class="form-control" rows="10" id="byeText" name="byeText">{{.records.ByeText}}</textarea>
        </div>

        <div class="mb-3" id="postProcessingContainer">
            <label for="postProcessingMessages" class="col-form-label fw-bold">Сообщение после окончания сценария</label>
            <textarea class="form-control" rows="2" id="postProcessingMessages" name="postProcessingMessages">{{.records.PostProcessingMessages}}</textarea>
        </div>

        <div class="mb-3">
            <label for="dialogLifeTimeInMinutes" class="col-form-label fw-bold">Время жизни диалога в минутах</label>
            <input type="text" class="form-control" id="dialogLifeTimeInMinutes" name="dialogLifeTimeInMinutes" value="{{.records.DialogLifeTimeInMinutes}}">
        </div>

        <div class="mb-3">
            <label for="followUpMessageIntervalInMinutes" class="col-form-label fw-bold">Интервал отправки напоминани о продолжении диалога в минутах</label>
            <input type="number" class="form-control" id="followUpMessageIntervalInMinutes" name="followUpMessageIntervalInMinutes" value="{{.records.FollowUpMessageIntervalInMinutes}}">
        </div>

        <div class="mb-3">
            <label for="countOfMessagesAfterFinishedDialog" class="col-form-label fw-bold">Кол-во сообщений после завершенного диалога</label>
            <input type="number" class="form-control" id="countOfMessagesAfterFinishedDialog" name="countOfMessagesAfterFinishedDialog" value="{{.countOfMessagesAfterFinishedDialog}}" placeholder="При пустом значении будет использоваться значение по умолчанию">
        </div>

        <div class="mb-3">
            <button type="submit" class="btn btn-primary d-none btn-save-individual" {{if .records.Id | not}}formaction="/dict/vacancy/add"{{end}}>Сохранить</button>
        </div>
        </form>
    </div>
    <div class="card px-3 py-3 d-none" id="vacancy-openai-card">
        <form class="row" method="post" action="/dict/vacancy-openai/update">
            <input type="hidden" id="vacancyId" name="vacancyId" value="{{.records.Id}}">
            <input type="hidden" id="openAIid" name="openAIid" value="{{.records.OpenAIDetails.Id}}">

            <div class="mb-3">
                <input id="LoadToZP" name="loadToZP" type="checkbox" class="form-check-input" {{if .records.LoadToZp}}checked{{end}}>
                <label class="form-check-label fw-bold" for="LoadToZP">Активная</label>
            </div>

            <div id="vacancy-view-info"  class="mb-3"></div>

            <div id="vacancy-dicts"     class="mb-3"></div>

            <div id="vacancy-text"
                 class="d-none"
                 data-rekl-id="{{if .records.ReklId}}{{$id := .records.ReklId}}{{$id}}{{else}}0{{end}}"
                 data-buying-type-id="{{if .records.BuyingTypeId}}{{$id := .records.BuyingTypeId}}{{$id}}{{else}}0{{end}}"
                 data-prof-id="{{if .records.ProfessionId}}{{$id := .records.ProfessionId}}{{$id}}{{else}}0{{end}}"
                 data-provider-id="{{if .records.ProviderId}}{{$id := .records.ProviderId}}{{$id}}{{else}}0{{end}}"
                 data-traffic-source-id="{{if .records.TrafficSourceId}}{{$id := .records.TrafficSourceId}}{{$id}}{{else}}0{{end}}"
                 data-export-type-id="{{if .records.ExportTypeId}}{{.records.ExportTypeId}}{{else}}0{{end}}"
                 data-cpa-ex-id="{{if .records.CpaExId}}{{.records.CpaExId}}{{end}}"
                 data-other-specification="{{if .records.OtherSpecification}}{{.records.OtherSpecification}}{{end}}">
                {{.information}}
            </div>

            <div class="mb-3">
                <label for="openaivacancyIdAvito" class="col-form-label fw-bold">ID Авито</label>
                <div id="manualAvitoInfoOpenAI" class="alert alert-info py-1 px-2 d-none"></div>
                <input  type="text"
                        class="form-control"
                        id="openaivacancyIdAvito"
                        name="vacancyIdAvito"
                        placeholder="ID Авито"
                        value="{{.avito_ids}}"
                        readonly>

                <label class="btn btn-outline-secondary mt-2" id="openaiAvitoFileLabel">
                    <span class="label-text">Загрузить из файла (.xlsx)</span>
                    <input type="file" id="openaiAvitoFile" accept=".xlsx" hidden>
                </label>

                <button type="button"
                        id="btn-manual-avito-openai"
                        class="btn btn-secondary mt-2 manual-avito-btn"
                        data-file-input="openaiAvitoFile"
                        data-file-label="openaiAvitoFileLabel"
                        data-info-div="manualAvitoInfoOpenAI"
                        data-bs-toggle="modal"
                        data-bs-target="#manualAvitoModal">
                    Загрузить вручную
                </button>

                <button type="button"
                        class="btn btn-primary mt-2 btn-download-avito">
                    Скачать ID Авито
                </button>
            </div>


            <div class="mb-3">
                <label for="questions" class="col-form-label fw-bold">Вопросы</label>
                <input type="text" class="form-control" id="questions" name="questions" value="{{.records.OpenAIDetails.Questions}}">
                <span class="text-secondary">Возможные типы вопросов: fio ; phone ; citizenship ; age ; email ; work_approve ; birthday</span>
            </div>

            <div class="mb-3">
                <label for="vacancyDescription" class="col-form-label fw-bold">Описание вакансии</label>
                <textarea class="form-control" rows="15" id="vacancyDescription" name="vacancyDescription">{{.records.OpenAIDetails.VacancyDescription}}</textarea>
            </div>

            <div class="mb-3">
                <label for="assistantDescription" class="col-form-label fw-bold">Описание OpenAI ассистента</label>
                <textarea class="form-control" rows="15" id="assistantDescription" name="assistantDescription">{{.records.OpenAIDetails.AssistantDescription}}</textarea>
            </div>

            <div class="mb-3">
                <label for="assistantTemperature" class="col-form-label fw-bold">Temperature OpenAI ассистента</label>
                <input type="number"
                       class="form-control"
                       id="assistantTemperature"
                       name="assistantTemperature"
                       min="0"
                       max="2"
                       step="0.01"
                       value="{{.records.OpenAIDetails.AssistantTemperature}}">
            </div>

            <div class="mb-3">
                <label for="dialogLifeTimeInMinutes" class="col-form-label fw-bold">Время жизни диалога в минутах</label>
                <input type="text" class="form-control" id="openai-dialogLifeTimeInMinutes" name="dialogLifeTimeInMinutes" value="{{.records.DialogLifeTimeInMinutes}}">
            </div>

            <div class="mb-3">
                <label for="followUpMessageIntervalInMinutes" class="col-form-label fw-bold">Интервал отправки напоминани о продолжении диалога в минутах</label>
                <input type="number" class="form-control" id="openai-followUpMessageIntervalInMinutes" name="followUpMessageIntervalInMinutes" value="{{.records.FollowUpMessageIntervalInMinutes}}">
            </div>

            <div class="mb-3">
                <label for="countOfMessagesAfterFinishedDialog" class="col-form-label fw-bold">Кол-во сообщений после завершенного диалога</label>
                <input type="number" class="form-control" id="openai-countOfMessagesAfterFinishedDialog" name="countOfMessagesAfterFinishedDialog" value="{{.countOfMessagesAfterFinishedDialog}}" placeholder="При пустом значении будет использоваться значение по умолчанию">
            </div>
        </form>
    </div>
    </br>

    <div class="card px-3 py-3">
    <h4>Привязанные офферы</h4>
    <div class="table-responsive">
        <table class="table table-default table-sm offers-table">
            <colgroup>
                <col style="width:35%">
                <col style="width:50%">
                <col style="width:15%">
            </colgroup>
            <thead>
            <tr>
                <th>Наименование</th>
                <th class="text-start">Действия</th>
                <th></th>
            </tr>
            </thead>

            <tbody>
            {{ $global := . }}
            {{range $index, $offer := .offers}}
            {{- $domId := cond (eq $offer.Id 0) (add -1 $index) $offer.Id -}}
            <tr data-offer-id="{{$domId}}">
                <td style="width:10px;">{{$offer.Name}}</td>
                <td class="text-start" style="width:150px;">
                    <button class="btn btn-secondary"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#editOffer-{{$domId}}"
                            aria-expanded="false"
                            aria-controls="editOffer-{{$domId}}">
                        Редактировать
                    </button>
                </td>
                <td class="text-end" style="width:100px;">
                    <button class="btn btn-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteOffer"
                            data-bs-whatever="{{$domId}}">
                        Удалить
                    </button>
                </td>
            </tr>

            <tr class="collapse"
                id="editOffer-{{$domId}}"
                data-offer-id="{{$domId}}">
                <td colspan="3" class="p-0">
                    <form class="row g-3" data-form="offer">
                        <input type="hidden" name="offerId"  value="{{$domId}}">
                        <input type="hidden" name="vacancyId" value="{{$global.records.Id}}">

                        <div class="col-md-2">
                            <div class="form-check">
                                <input class="form-check-input"
                                       type="checkbox"
                                       name="enable"
                                       {{if $offer.Enable}}checked{{end}}>
                                <label class="form-check-label fw-bold">Активен</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input"
                                       type="checkbox"
                                       name="ignoreName"
                                       {{if $offer.IgnoreName}}checked{{end}}>
                                <label class="form-check-label fw-bold">Игнорировать имя лида</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input"
                                       type="checkbox"
                                       name="exportZpPg"
                                       {{if $offer.ExportZpPg}}checked{{end}}>
                                <label class="form-check-label fw-bold">Экспорт ZP PG</label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold">Наименование</label>
                            <input class="form-control"
                                   type="text"
                                   name="offerName"
                                   value="{{$offer.Name}}"
                                   readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Имя скрипта ZP</label>
                            <input class="form-control"
                                   type="text"
                                   name="zpScriptName"
                                   value="{{$offer.ZpScriptName}}">
                        </div>

                        <div class="col-md-12">
                            <label class="form-label fw-bold">SQL запрос</label>
                            <textarea class="form-control"
                                      rows="3"
                                      name="sqlForZp"
                                      style="white-space: pre-wrap;">{{$offer.SqlForZp}}</textarea>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label fw-bold">Тип экспорта</label>
                            <select name="exportTypeId" class="form-select export-type-select"
                                    data-offer-id="{{$domId}}"
                                    data-current="{{$offer.ExportTypeId}}"
                                    data-client-sheet-id="{{$offer.ClientOfferSetting.SheetId}}"
                                    data-client-tab-name="{{$offer.ClientOfferSetting.SheetName}}"
                                    data-client-link="{{$offer.ClientOfferSetting.Link}}">
                            </select>
                            <div id="exportExtraFields-{{$domId}}"
                                 class="mt-3"
                                 style="display:none;"></div>
                        </div>
                    </form>

                    <div class="mt-3 px-0">
                        <h5>Фильтры</h5>
                        <div class="table-responsive">
                            <table class="table table-default table-sm filters-table">
                                <colgroup>
                                    <col style="width:35%">
                                    <col style="width:50%">
                                    <col style="width:10%">
                                </colgroup>
                                <thead>
                                <tr><th>Наименование</th><th class="text-start">Значение</th><th></th></tr>
                                </thead>
                                <tbody>
                                {{range $f := $offer.OfferFilters}}
                                <tr data-filter-id="{{$f.SqlFilterId}}">
                                    <td class="filter-name">—</td>
                                    <td class="filter-val">—</td>
                                    <td class="text-end">
                                        <button class="btn btn-primary"
                                                data-bs-toggle="modal"
                                                data-bs-target="#deleteFilter"
                                                data-bs-whatever="{{$f.SqlFilterId}}">
                                            Удалить
                                        </button>
                                    </td>
                                </tr>
                                {{end}}

                                <tr id="newFilterRow-{{$domId}}" class="d-none align-middle">
                                    <form class="add-filter-form" action="/dict/offers/add_filter" method="post">
                                        <input type="hidden" name="offerId" value="{{$domId}}">
                                        <td colspan="2">
                                            <select class="form-select filter-select" name="filterId"></select>
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-primary" type="submit">Добавить</button>
                                        </td>
                                    </form>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="3">
                                        <button class="btn btn-secondary"
                                                type="button"
                                                onclick="document.getElementById('newFilterRow-{{$domId}}').classList.remove('d-none');">
                                            Добавить фильтр
                                        </button>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                </td>
            </tr>
            {{end}}
            <tr id="newOfferForm" class="d-none">
                <td colspan="3">
                    <form class="row g-3" method="post" action="/dict/offers/create">
                        <input type="hidden" name="vacancyId" value="{{.records.Id}}">

                        <!-- 1-я строка: чекбоксы -->
                        <div class="col-md-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="newEnable" name="enable">
                                <label class="form-check-label fw-bold" for="newEnable">Активен</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="newIgnoreName" name="ignoreName">
                                <label class="form-check-label fw-bold" for="newIgnoreName">Игнорировать имя лида</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="newExportZPPG" name="exportZpPg">
                                <label class="form-check-label fw-bold" for="newExportZPPG">Экспорт ZP PG</label>
                            </div>
                        </div>

                        <!-- 2-я строка: Наименование, Имя скрипта -->
                        <div class="col-md-6">
                            <label for="newOfferName" class="form-label fw-bold">Наименование</label>
                            <input type="text" class="form-control" id="newOfferName" name="offerName" placeholder="Наименование" readonly>
                        </div>
                        <div class="col-md-6">
                            <label for="newZpScriptName" class="form-label fw-bold">Имя скрипта ZP</label>
                            <input type="text" class="form-control" id="newZpScriptName" name="zpScriptName" placeholder="Имя скрипта ZP">
                        </div>

                        <!-- 3-я строка: SQL запрос (textarea) -->
                        <div class="col-md-12">
                            <label for="newSqlForZP" class="form-label fw-bold">SQL запрос</label>
                            <textarea class="form-control" rows="3" id="newSqlForZP" name="sqlForZp" style="white-space: pre-wrap;"></textarea>
                        </div>

                        <div class="col-md-6">
                            <label for="export_type_id-new" class="form-label fw-bold">Тип экспорта</label>
                            <select id="export_type_id-new"
                                    name="exportTypeId"
                                    class="form-select export-type-select"
                                    data-offer-id="new"
                                    data-current="">
                            </select>
                        </div>
                        <div id="exportExtraFields-new" class="mt-3" style="display: none;">
                        </div>

                        <!-- 5-я строка: Кнопки -->
                        <div class="col-md-12">
                            <button type="submit" class="btn btn-primary">Добавить оффер</button>
                            <button type="button" class="btn btn-secondary" onclick="addClass('newOfferForm','d-none'); document.getElementById('btn-add-offer').style.display='inline-block';">Свернуть</button>
                        </div>
                    </form>
                </td>
            </tr>

            </tbody>
            {{if or (not $global.offers) (eq (len $global.offers) 0)}}
            <tfoot>
            <tr>
                <td colspan="3">
                    <button type="button" id="btn-add-offer" onclick="deleteClass('newOfferForm', 'd-none'); this.style.display='none';" class="btn btn-secondary">Добавить оффер</button>
                </td>
            </tr>
            </tfoot>
            {{end}}

        </table>

        <div class="modal fade" tabindex="-1" role="dialog" id="deleteOffer">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Удаление</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="post" action="/dict/vacancy/delete_offer">
                        <input type="hidden" id="vacancyId" name="vacancyId" value="{{.records.Id}}">
                        <div class="modal-body">
                            <p>Вы действительно хотите удалить запись?</p>
                            <input type="hidden" id="vac2vacId" name="vac2vacId">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                            <button type="button" id="confirmDeleteOffer" class="btn btn-primary">Удалить</button>   <!-- в #deleteOffer -->
                        </div>
                    </form>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="deleteFilter">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Удаление</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="post" action="/dict/offers/delete_filter">
                        <input type="hidden" id="offerId" name="offerId" value="{{.records.Id}}">
                        <div class="modal-body">
                            <p>Вы действительно хотите удалить запись?</p>
                            <input type="hidden" id="offerSqlFilterId" name="offerSqlFilterId">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                            <button type="button" id="confirmDeleteFilter" class="btn btn-primary">Удалить</button> <!-- в #deleteFilter -->
                        </div>
                    </form>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

        <div class="modal fade" id="manualAvitoModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Ручная загрузка Avito ID</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <textarea id="manualAvitoIds"
                                  class="form-control"
                                  rows="5"
                                  placeholder="Введите Avito ID через запятую: 1, 2, 3"></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="button" id="confirmManualAvito" class="btn btn-primary">Сохранить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <div class="mb-3">
        <button id="saveAllBtn" class="btn btn-success">
            Сохранить
        </button>

        {{if .records.Id}}
        <a class="btn btn-primary"
           href="/dict/vacancy_admin/edit/0?copyFrom={{.records.Id}}">
            Копировать
        </a>
        {{end}}
    </div>


</div>
{{ end }}

{{ define "css" }}
<style>
    .btn-save-individual{display:none!important;}
    .offers-table,
    .filters-table {
        table-layout: fixed;
        width: 100%;
    }

    .filters-table .filter-select {
        width: 100%;
    }

    label.disabled {
        pointer-events: none;
        opacity: .6;
    }

</style>
<link href="/static/css/select2-bootstrap-5-theme.min.css" rel="stylesheet">
<link href="/static/css/select2.min.css" rel="stylesheet">
{{ end}}